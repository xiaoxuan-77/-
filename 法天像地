-- 体型控制UI（1000倍上限·可拖动·可关闭·LocalScript）
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui") -- 确保UI容器加载

-- 1. 创建UI（含拖动标题栏+关闭按钮）
local ui = Instance.new("ScreenGui")
ui.Name = "SizeControlUI"
ui.Parent = PlayerGui

-- 主面板（可拖动）
local panel = Instance.new("Frame")
panel.Size = UDim2.new(0, 180, 0, 110)
panel.Position = UDim2.new(0.5, -90, 0.5, -55)
panel.BackgroundColor3 = Color3.new(0.15, 0.15, 0.15)
panel.BackgroundTransparency = 0.3
panel.Active = true -- 启用鼠标事件接收
panel.Draggable = true -- 核心拖动功能
panel.Parent = ui

-- 标题栏（拖动触发区）
local titleBar = Instance.new("TextLabel")
titleBar.Size = UDim2.new(1, 0, 0, 25)
titleBar.BackgroundColor3 = Color3.new(0.25, 0.25, 0.35)
titleBar.Text = "体型控制（1000倍上限）"
titleBar.TextColor3 = Color3.new(1, 1, 1)
titleBar.TextSize = 12
titleBar.TextXAlignment = Enum.TextXAlignment.Center
titleBar.Parent = panel

-- 新增：关闭按钮（右上角）
local closeBtn = Instance.new("TextButton")
closeBtn.Name = "CloseUI"
closeBtn.Size = UDim2.new(0, 20, 0, 20)
closeBtn.Position = UDim2.new(1, -23, 0, 2.5) -- 靠标题栏右上角定位
closeBtn.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
closeBtn.Text = "×"
closeBtn.TextColor3 = Color3.new(1, 1, 1)
closeBtn.TextSize = 14
closeBtn.TextXAlignment = Enum.TextXAlignment.Center
closeBtn.Parent = panel
-- 关闭逻辑：点击销毁整个UI
closeBtn.MouseButton1Click:Connect(function()
    ui:Destroy()
end)

-- 体型显示标签（避开标题栏）
local sizeLabel = Instance.new("TextLabel")
sizeLabel.Size = UDim2.new(1, 0, 0, 25)
sizeLabel.Position = UDim2.new(0, 0, 0, 25)
sizeLabel.BackgroundTransparency = 1
sizeLabel.Text = "当前体型：1.0x"
sizeLabel.TextColor3 = Color3.new(1, 1, 1)
sizeLabel.TextScaled = true
sizeLabel.Parent = panel

-- 放大按钮
local enlargeBtn = Instance.new("TextButton")
enlargeBtn.Size = UDim2.new(0.45, 0, 0, 30)
enlargeBtn.Position = UDim2.new(0, 5, 0, 60)
enlargeBtn.BackgroundColor3 = Color3.new(0.2, 0.7, 0.2)
enlargeBtn.Text = "放大"
enlargeBtn.TextColor3 = Color3.new(1, 1, 1)
enlargeBtn.TextScaled = true
enlargeBtn.Parent = panel

-- 缩小按钮
local shrinkBtn = Instance.new("TextButton")
shrinkBtn.Size = UDim2.new(0.45, 0, 0, 30)
shrinkBtn.Position = UDim2.new(0.5, 5, 0, 60)
shrinkBtn.BackgroundColor3 = Color3.new(0.7, 0.2, 0.2)
shrinkBtn.Text = "缩小"
shrinkBtn.TextColor3 = Color3.new(1, 1, 1)
shrinkBtn.TextScaled = true
shrinkBtn.Parent = panel

-- 2. 核心体型控制逻辑（保留原功能）
local currentSize = 1.0
local sizeStep = 0.8
local sizeLimit = {min=0.0001, max=1000.0}
local char

-- 角色加载时应用当前体型
player.CharacterAdded:Connect(function(c)
    char = c
    char:ScaleTo(currentSize)
end)

-- 放大逻辑
enlargeBtn.MouseButton1Click:Connect(function()
    if not char then
        sizeLabel.Text = "角色未加载！"
        sizeLabel.TextColor3 = Color3.new(1,0.5,0.5)
        task.wait(1.5)
        sizeLabel.Text = string.format("当前体型：%.1fx", currentSize)
        sizeLabel.TextColor3 = Color3.new(1,1,1)
        return
    end
    if currentSize < sizeLimit.max then
        currentSize = math.min(currentSize + sizeStep, sizeLimit.max)
        char:ScaleTo(currentSize)
        sizeLabel.Text = string.format("当前体型：%.1fx", currentSize)
    else
        sizeLabel.Text = "已达500倍上限！"
        sizeLabel.TextColor3 = Color3.new(1,0.8,0)
        task.wait(1)
        sizeLabel.Text = string.format("当前体型：%.1fx", currentSize)
        sizeLabel.TextColor3 = Color3.new(1,1,1)
    end
end)

-- 缩小逻辑
shrinkBtn.MouseButton1Click:Connect(function()
    if not char then
        sizeLabel.Text = "角色未加载！"
        sizeLabel.TextColor3 = Color3.new(1,0.5,0.5)
        task.wait(1.5)
        sizeLabel.Text = string.format("当前体型：%.1fx", currentSize)
        sizeLabel.TextColor3 = Color3.new(1,1,1)
        return
    end
    if currentSize > sizeLimit.min then
        currentSize = math.max(currentSize - sizeStep, sizeLimit.min)
        char:ScaleTo(currentSize)
        sizeLabel.Text = string.format("当前体型：%.1fx", currentSize)
    else
        sizeLabel.Text = "已达最小体型！"
        sizeLabel.TextColor3 = Color3.new(1,0.8,0)
        task.wait(1)
        sizeLabel.Text = string.format("当前体型：%.1fx", currentSize)
        sizeLabel.TextColor3 = Color3.new(1,1,1)
    end
end)
